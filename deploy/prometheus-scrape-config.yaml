# Example Prometheus scrape configuration for ops-mcp-server
# Add this to your prometheus.yml or prometheus-configmap.yaml

# Option 1: Using kubernetes_sd_configs (automatic discovery via annotations)
scrape_configs:
  - job_name: 'ops-mcp-server'
    kubernetes_sd_configs:
      - role: pod
        namespaces:
          names:
            - ops-system
    relabel_configs:
      # Only scrape pods with prometheus.io/scrape=true annotation
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      # Use the port from annotation
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        target_label: __address__
        regex: (.+)
        replacement: $1:__meta_kubernetes_pod_annotation_prometheus_io_port
      # Use the path from annotation
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      # Add pod labels
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod
      - source_labels: [__meta_kubernetes_namespace]
        target_label: namespace
      - source_labels: [__meta_kubernetes_pod_label_app]
        target_label: app

# Option 2: Using static_configs (manual configuration)
# scrape_configs:
#   - job_name: 'ops-mcp-server'
#     static_configs:
#       - targets:
#         - 'ops-mcp-server.ops-system.svc.cluster.local:80'
#     metrics_path: '/mcp/metrics'
#     scrape_interval: 15s
#     scrape_timeout: 10s
#     relabel_configs:
#       - source_labels: [__address__]
#         target_label: instance
#       - target_label: namespace
#         replacement: ops-system
#       - target_label: app
#         replacement: ops-mcp-server

