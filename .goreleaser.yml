project_name: ops-mcp-server
before:
  env:
    - GOSUMDB=off
    - GOPROXY=direct
  hooks:
    - go mod download
    - go mod tidy
    - go mod vendor
builds:
  - env:
      - CGO_ENABLED=0
      - GOSUMDB=off
    main: ./cmd/server/main.go
    binary: ops-mcp-server
    goos:
      - linux
      - darwin
    goarch:
      - amd64
      - arm64
    goarm:
      - "7"
    mod_timestamp: "{{ .CommitTimestamp }}"
    flags:
      - -trimpath
      - -mod=vendor
    tags: containers_image_openpgp
    ldflags:
      - -X "github.com/shaowenchen/ops-mcp-server/cmd/version.BuildVersion={{ .Version }}"
      - -X "github.com/shaowenchen/ops-mcp-server/cmd/version.BuildDate={{ .Date }}"
      - -X "github.com/shaowenchen/ops-mcp-server/cmd/version.GitCommitID={{ .ShortCommit }}"
      - -w
      - -s
dist: bin
archives:
  - name_template: "ops-mcp-server-{{ .Version }}-{{ .Os }}-{{ .Arch }}"
    files:
      - configs/
      - deploy/
changelog:
  skip: true
